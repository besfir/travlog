import{p as m,R as w,Z as c,n as _,a1 as S}from"./entry.g98QEZ7a.js";import{c as P}from"./config-generator.CU994Y-X.js";import{u as i,q as o}from"./query.DLM-Vm2F.js";async function I([e,...t],a={},n=!0){var d,h,g;const r=+(m().params.page||1),u=w().locale.value,{PER_PAGE_NUM:s}=P().CONSTANT,f=Object.assign({_draft:!1},a),{data:p,error:l,pending:C}=await i(`blog-page-${r}-${u}`,()=>Promise.all([o(e,...t).only(["_draft"]).where(f).find(),o(e,...t).where(f).sort({createdAt:-1}).limit(s).locale(u).skip((r-1)*s).find()]),{server:n,lazy:!n});if(l.value)throw c({statusCode:500,statusMessage:((d=l.value)==null?void 0:d.statusMessage)||"Unknown Error"});return{totalSize:(h=p.value)==null?void 0:h[0].length,posts:(g=p.value)==null?void 0:g[1],pending:C,error:l}}async function R(){const e=m().path,t=w().locale.value,a="/"+e.split("/").filter(s=>s&&t!==s).join("/"),n=await v(a,t),r=await N(a,t),u=await b(t,n.value.series);return{post:n,surround:r,seriesItem:u}}async function v(e,t){const{data:a}=await i(`post-${y(e)}-${t}`,()=>o().where({_path:e}).locale(t).findOne());if(!a.value)throw c({statusCode:404,statusMessage:`Cannot found: ${e}`});return a}async function N(e,t){var n;const{data:a}=await i(`post-surround-${y(e)}-${t}`,()=>o().only(["title","_path","description"]).sort({createdAt:1}).where({_draft:!1}).locale(t).findSurround(e));if(!((n=a.value)!=null&&n.length))throw c({statusCode:404,statusMessage:`Cannot found surround: ${e}`});return a}async function b(e,t){if(t){const{data:a}=await i(`series-${t}-${e}`,()=>o().where({series:t,_draft:!1}).locale(e).only(["title","_path"]).find());return a}return _([])}function y(e){return e.replaceAll("/","")}const A="3.3.0",$="https://api.applause-button.com";function j(){return{getClap:O,getClapMultiple:M,updateClaps:T}}async function O(e){const t=S().url;return+await $fetch(`${$}/get-claps?url=${t+e}`)}function M(e){return fetch("https://api.applause-button.com/get-multiple",{method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(e)}).then(t=>t.json()).then(t=>t)}function T(e){return fetch(`${$}/update-claps?url=${e}`,{method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(`1,${A}`)}).then(t=>t.text()).then(t=>Number(t))}export{I as a,R as f,j as u};
