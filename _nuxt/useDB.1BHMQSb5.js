import{ac as g,as as p,aA as i,r as y}from"./entry.OAaAq3eu.js";import{c as v}from"./config-generator.CU994Y-X.js";import{u as c,q as o}from"./query.wxcY98eE.js";async function E([a,...t],e={},s=!0){var w,_,h;const r=+(g().params.page||1),u=p().locale.value,{PER_PAGE_NUM:n}=v().CONSTANT,f=Object.assign({_locale:u,_draft:!1},e),{data:d,error:l,pending:m}=await c("blog-page-"+r,()=>Promise.all([o(a,...t).only(["_draft"]).where(f).find(),o(a,...t).where(f).sort({createdAt:-1}).limit(n).skip((r-1)*n).find()]),{server:s,lazy:!s});if(l.value)throw i({statusCode:500,statusMessage:((w=l.value)==null?void 0:w.statusMessage)||"Unknown Error"});return{totalSize:(_=d.value)==null?void 0:_[0].length,posts:(h=d.value)==null?void 0:h[1],pending:m,error:l}}async function z(){const a=g().path,t=p().locale.value,e="/"+a.split("/").filter(n=>n&&t!==n).join("/"),s=await C(e,t),r=await P(e,t),u=await A(t,s.value.series);return{post:s,surround:r,seriesItem:u}}async function C(a,t){const{data:e}=await c(`content-${a}`,()=>o().where({_locale:t,_path:a}).findOne());if(!e.value)throw i({statusCode:404,statusMessage:`Cannot found: ${a}`});return e}async function P(a,t){var s;const{data:e}=await c(`content-${a}-test`,()=>o().only(["title","_path","description"]).sort({createdAt:1}).where({_locale:t,_draft:!1}).findSurround(a));if(!((s=e.value)!=null&&s.length))throw i({statusCode:404,statusMessage:`Cannot found surround: ${a}`});return e}async function A(a,t){if(t){const{data:e}=await c(`series-${t}`,()=>o().where({_locale:a,series:t,_draft:!1}).only(["title","_path"]).find());return e}return y([])}export{E as a,z as f};
