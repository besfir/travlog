import{y as g,a1 as p,P as i,x as y}from"./entry.D4goAMF7.js";import{c as v}from"./config-generator.CU994Y-X.js";import{u as c,q as o}from"./query.BvSO6Vfk.js";async function E([e,...t],a={},s=!0){var w,_,h;const r=+(g().params.page||1),u=p().locale.value,{PER_PAGE_NUM:n}=v().CONSTANT,f=Object.assign({_locale:u,_draft:!1},a),{data:d,error:l,pending:m}=await c("blog-page-"+r,()=>Promise.all([o(e,...t).only(["_draft"]).where(f).find(),o(e,...t).where(f).sort({createdAt:-1}).limit(n).skip((r-1)*n).find()]),{server:s,lazy:!s});if(l.value)throw i({statusCode:500,statusMessage:((w=l.value)==null?void 0:w.statusMessage)||"Unknown Error"});return{totalSize:(_=d.value)==null?void 0:_[0].length,posts:(h=d.value)==null?void 0:h[1],pending:m,error:l}}async function z(){const e=g().path,t=p().locale.value,a="/"+e.split("/").filter(n=>n&&t!==n).join("/"),s=await C(a,t),r=await P(a,t),u=await A(t,s.value.series);return{post:s,surround:r,seriesItem:u}}async function C(e,t){const{data:a}=await c(`content-${e}`,()=>o().where({_locale:t,_path:e}).findOne());if(!a.value)throw i({statusCode:404,statusMessage:`Cannot found: ${e}`});return a}async function P(e,t){var s;const{data:a}=await c(`content-${e}-test`,()=>o().only(["title","_path","description"]).sort({createdAt:1}).where({_locale:t,_draft:!1}).findSurround(e));if(!((s=a.value)!=null&&s.length))throw i({statusCode:404,statusMessage:`Cannot found surround: ${e}`});return a}async function A(e,t){if(t){const{data:a}=await c(`series-${t}`,()=>o().where({_locale:e,series:t,_draft:!1}).only(["title","_path"]).find());return a}return y([])}export{E as a,z as f};
